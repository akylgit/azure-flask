trigger:
  branches:
    include:
      - main

pool:
  name: azureagent

variables:
- group: RenderSecrets

steps:
- checkout: self

- task: UsePythonVersion@0
  inputs:
    versionSpec: '3.12'
    addToPath: true

- script: |
    python -m pip install --upgrade pip
    pip install -r requirements.txt
  displayName: 'Install Python dependencies'

- task: ArchiveFiles@2
  inputs:
    rootFolderOrFile: '$(System.DefaultWorkingDirectory)'
    includeRootFolder: false
    archiveFile: '$(Build.ArtifactStagingDirectory)/app.zip'
    replaceExistingArchive: true
  displayName: 'Package app'

- script: |
    curl -X POST "https://api.render.com/deploy/$(RENDER_SERVICE_ID)" \
         -H "Accept: application/json" \
         -H "Authorization: Bearer $(RENDER_API_KEY)"
  displayName: 'Deploy to Render'



